<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Email Campaign QA Form</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background: #f9f9f9; padding: 0; margin: 0; }
    header { background: #001F3F; color: white; padding: 1rem; text-align: center; }
    form { max-width: 900px; margin: 2rem auto; background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    .form-group { margin-bottom: 1rem; }
    label { display: block; font-weight: 600; margin-bottom: 0.5rem; }
    input, textarea, select { width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px; font-size: 1rem; }
    button { background: #0074D9; color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 4px; cursor: pointer; font-size: 1rem; margin-right: 10px; }
    button:hover { background: #005fa3; }
    #submissionIdDisplay { display: none; font-weight: bold; color: green; margin-top: 1rem; }
  </style>
</head>
<body>
  <header>
    <h1>Email Campaign QA Form</h1>
  </header>

  <form id="qaForm">
    <!-- Hidden tracking fields -->
    <input type="hidden" id="createDate" name="Create Date" />
    <input type="hidden" id="submissionTime" name="Submission Time" />
    <input type="hidden" id="submissionId" name="Submission ID" />

    <!-- Main Fields -->
    <div class="form-group"><label for="filledBy">Form Filled By</label><input type="text" id="filledBy" name="Form Filled By" required></div>
    <div class="form-group"><label for="clientName">Client Name</label><input type="text" id="clientName" name="Client Name" required></div>
<div class="form-group"><label for="campaignType">Campaign Type</label><select id="campaignType" name="Campaign Type"><option value="">-- Select Campaign Type --</option><option value="Manual Campaigns">Manual Campaigns</option><option value="SMS">SMS</option><option value="Automation emails">Automation emails</option></select></div><br>
<div class="form-group"><label for="jobType">Job Type</label><select id="jobType" name="Job Type"><option value="">-- Select Job Type --</option><option value="Design only">Design only</option><option value="Design + Coding">Design + Coding</option><option value="Coding only">Coding only</option></select></div>
    <div class="form-group"><label for="noOfEmails">No of Emails</label><input type="number" id="noOfEmails" name="No of Emails" /></div>
    <div class="form-group"><label for="emailName">Email/SMS/Automation Name</label><input type="text" id="emailName" name="Email/SMS/Automation Name" /></div>
    <div class="form-group"><label for="esp">ESP</label><input type="text" id="esp" name="ESP" /></div>
    <div class="form-group"><label for="fromName">From Name</label><input type="text" id="fromName" name="From Name" /></div>
    <div class="form-group"><label for="fromEmail">From Email Address</label><input type="email" id="fromEmail" name="From Email Address" /></div>
    <div class="form-group"><label for="replyToEmail">Reply-to Email Address</label><input type="email" id="replyToEmail" name="Reply-to Email Address" /></div>
    <div class="form-group"><label for="subjectLine">Subject Line</label><input type="text" id="subjectLine" name="Subject Line" /></div>
    <div class="form-group"><label for="previewText">Preview Text</label><input type="text" id="previewText" name="Preview Text" /></div>
<div class="form-group"><label for="abTest">A/B Testing</label><select id="abTest" name="A/B Testing"><option value="">-- Select A/B Testing Type --</option><option value="Subject line A/B testing">Subject line A/B testing</option><option value="Time">Time</option><option value="Content">Content</option><option value="Design changes / Layout changes">Design changes / Layout changes</option><option value="Other">Other</option><option value="No">No</option></select></div>
    <div class="form-group"><label for="abDetails">A/B Test Details</label><textarea id="abDetails" name="A/B Test Details"></textarea></div>
    <div class="form-group"><label for="mainList">Main List</label><input type="text" id="mainList" name="Main List" /></div>
    <div class="form-group"><label for="segment">Segment</label><input type="text" id="segment" name="Segment" /></div>
    <div class="form-group"><label for="count">Count (After Suppression)</label><input type="text" id="count" name="Count (After Suppression)" /></div>
    <div class="form-group"><label for="campaignDate">Campaign Date</label><input type="date" id="campaignDate" name="Campaign Date" /></div>
    <div class="form-group"><label for="campaignTime">Campaign Time</label><input type="time" id="campaignTime" name="Campaign Time" /></div>
    <div class="form-group"><label for="testEmail">Test Email List/Person</label><input type="email" id="testEmail" name="Test Email List/Person" /></div><br>
<div class="form-group" style="display: flex; align-items: center;"><label style="min-width: 420px;">Link Check</label><label style="margin-right: 10px;"><input type="radio" name="Link Check" value="Yes" /> Yes</label><label><input type="radio" name="Link Check" value="No" /> No</label></div><br>
<div class="form-group" style="display: flex; align-items: center;"><label style="min-width: 420px;">Content Error Check</label><label style="margin-right: 10px;"><input type="radio" name="Content Error Check" value="Yes" /> Yes</label><label><input type="radio" name="Content Error Check" value="No" /> No</label></div>
<div class="form-group" style="display: flex; align-items: center;"><label style="min-width: 420px;">Alt Tag Check</label><label style="margin-right: 10px;"><input type="radio" name="Alt Tag Check" value="Yes" /> Yes</label><label><input type="radio" name="Alt Tag Check" value="No" /> No</label></div>

    <div class="form-group"><label for="promoCode">Promo Code?</label><input type="text" id="promoCode" name="Promo code?" /></div>
	<div class="form-group" style="display: flex; align-items: center;"><label style="min-width: 420px;">CAN-SPAM Compliant</label><label style="margin-right: 10px;"><input type="radio" name="CAN-SPAM Compliant" value="Yes" /> Yes</label><label><input type="radio" name="CAN-SPAM Compliant" value="No" /> No</label></div>

  <div class="form-group" style="display: flex; align-items: center;"><label style="min-width: 420px;">Unsubscribe Link</label><label style="margin-right: 10px;"><input type="radio" name="Unsubscribe Link" value="Yes" /> Yes</label><label><input type="radio" name="Unsubscribe Link" value="No" /> No</label></div>
<div class="form-group" style="display: flex; align-items: center;"><label style="min-width: 420px;">Salutation (First Name)</label><label style="margin-right: 10px;"><input type="radio" name="Salutation(First Name)" value="Yes" /> Yes</label><label><input type="radio" name="Salutation(First Name)" value="No" /> No</label></div>

    <div class="form-group"><label for="spf">SPF</label><select id="spf" name="SPF"><option>PASS</option><option>FAIL</option></select></div>
    <div class="form-group"><label for="dkim">DKIM</label><select id="dkim" name="DKIM"><option>PASS</option><option>FAIL</option></select></div>
    <div class="form-group"><label for="dmarc">DMARC</label><select id="dmarc" name="DMARC"><option>PASS</option><option>FAIL</option></select></div>
<div class="form-group" style="display: flex; align-items: center;"><label style="min-width: 420px;">UTM Tracking?</label><label style="margin-right: 10px;"><input type="radio" name="UTM Tracking?" value="Yes" /> Yes</label><label><input type="radio" name="UTM Tracking?" value="No" /> No</label></div>
    <div class="form-group"><label for="liveLink">Live Campaign Link</label><input type="text" id="liveLink" name="Live Campaign Link" /></div>
    <div class="form-group"><label for="eoa">EOA</label><input type="text" id="eoa" name="EOA" /></div>
    <div class="form-group"><label for="renderingIssues">Any Rendering Issues</label><textarea id="renderingIssues" name="Any Rendering Issues - Device Name + Platform"></textarea></div>
<div class="form-group"><label for="approval">Campaign Approval</label><select id="approval" name="Campaign Approval"><option value="">-- Select Approval Status --</option><option value="Pending">Pending</option><option value="Approved">Approved</option></select></div>
    <div class="form-group"><label for="links">LINKS (Title + Link)</label><textarea id="links" name="LINKS"></textarea></div>

    <!-- Buttons -->
    <button type="button" id="saveBtn">Save</button>
    <button type="submit">Submit</button>
    <p id="submissionIdDisplay"></p>
  </form>

  <!-- Fetch/Edit Existing Entry -->
  <form id="editForm" style="max-width: 900px; margin: auto;">
    <div class="form-group">
      <label for="searchResponseId">Enter Submission ID to Edit</label><br>
      <input type="text" id="searchResponseId" /><br><br>
      <button type="button" id="fetchDataBtn">Fetch Data</button>
    </div>
  </form>


<script>
  const scriptURL = 'https://script.google.com/macros/s/AKfycbyvOW-4C5GyShDchfDuog1WQ68JHOa9DhMjsDeBLORlGD19i3jH7uOms9PlalViGro44A/exec';

  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('qaForm');

    // Set Create Date and Submission Time with specific formatting (CST)
    const createDateField = document.getElementById("createDate");
    const submissionTimeField = document.getElementById("submissionTime");

    const options = {
      timeZone: 'America/Chicago',  // CST (Central Standard Time)
      year: 'numeric',
      month: '2-digit',
      day: '2-digit',
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit',
      hour12: true
    };

    const currentDate = new Date();

    if (createDateField) {
      createDateField.value = currentDate.toLocaleString('en-US', options);  // Set Create Date in CST
    }

    // Save and Submit
    form.addEventListener('submit', e => handleSubmit(e, "submit"));
    document.getElementById('saveBtn').addEventListener('click', e => handleSubmit(e, "save"));

    function handleSubmit(e, status) {
      e.preventDefault();

      // Set Submission Time in CST (same format as Create Date)
      if (submissionTimeField) {
        submissionTimeField.value = currentDate.toLocaleString('en-US', options);
      }

      const formData = new FormData(form);
      formData.append("Form Status", status);

      fetch(scriptURL, { method: 'POST', body: formData })
        .then(res => res.text())
        .then(id => {
          document.getElementById('submissionId').value = id;
          document.getElementById('submissionIdDisplay').innerText = `Submission ID: ${id}`;
          document.getElementById('submissionIdDisplay').style.display = 'block';
          alert(`${status === 'save' ? 'Saved' : 'Submitted'} successfully!`);
        })
        .catch(err => alert("Error submitting form: " + err));
    }

    // Fetch existing entry based on Submission ID
    document.getElementById('fetchDataBtn').addEventListener('click', () => {
      const submissionId = document.getElementById('searchResponseId').value.trim();
      if (!submissionId) {
        alert('Please enter a Submission ID.');
        return;
      }

      fetch(`${scriptURL}?action=get&id=${submissionId}`)
        .then(response => response.json())
        .then(data => {
          if (data.status === 'success') {
            Object.keys(data.entry).forEach(key => {
              const field = document.querySelector(`[name="${key}"]`);
              if (field) {
                if (field.type === 'checkbox') {
                  field.checked = data.entry[key] === 'TRUE';
                } else if (field.type === 'date' && key === "Campaign Date") {
                  // Convert the campaign date to YYYY-MM-DD format
                  const dateVal = new Date(data.entry[key]);
                  if (!isNaN(dateVal)) {
                    field.value = dateVal.toISOString().split("T")[0]; // Format: YYYY-MM-DD
                  }
                } else if (field.type === 'time' && key === "Campaign Time") {
                  const timeStr = data.entry[key];
                  if (timeStr && (timeStr.includes("AM") || timeStr.includes("PM"))) {
                    const parsedTime = convertTo24Hr(timeStr);
                    if (parsedTime) {
                      field.value = parsedTime;
                    }
                  } else {
                    field.value = timeStr;  // Directly set the time if it's already in a 24-hour format
                  }
                } else {
                  field.value = data.entry[key];
                }
              }
            });

            // Helper to convert 12-hour AM/PM time to 24-hour format
            function convertTo24Hr(time12h) {
              const [time, modifier] = time12h.trim().split(' ');
              if (!time || !modifier) return null;
              let [hours, minutes] = time.split(':');
              if (!minutes) minutes = "00";
              if (hours === '12') hours = '00';
              if (modifier.toUpperCase() === 'PM') hours = parseInt(hours, 10) + 12;
              return `${hours.toString().padStart(2, '0')}:${minutes}`;
            }

            document.getElementById('submissionIdDisplay').innerText = `Editing Submission ID: ${submissionId}`;
            document.getElementById('submissionIdDisplay').style.display = 'block';
            document.getElementById('submissionId').value = submissionId;
          } else {
            alert(`No entry found for Submission ID: ${submissionId}`);
          }
        })
        .catch(err => alert("Failed to fetch data: " + err));
    });
  });
</script>






</body>
</html>
