<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Email Campaign QA Form</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background: #f9f9f9; padding: 0; margin: 0; }
    header { background: #001F3F; color: white; padding: 1rem; text-align: center; }
    form { max-width: 900px; margin: 2rem auto; background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    .form-group { margin-bottom: 1rem; }
    label { display: block; font-weight: 600; margin-bottom: 0.5rem; }
    input, textarea, select { width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px; font-size: 1rem; }
    button { background: #0074D9; color: white; padding: 0.75rem 1.5rem; border: none; border-radius: 4px; cursor: pointer; font-size: 1rem; margin-right: 10px; }
    button:hover { background: #005fa3; }
    #submissionIdDisplay { display: none; font-weight: bold; color: green; margin-top: 1rem; }
  </style>
</head>
<body>
  <header>
    <h1>Email Campaign QA Form</h1>
  </header>

  <form id="qaForm">
    <!-- Hidden tracking fields -->
    <input type="hidden" id="createDate" name="Create Date" />
    <input type="hidden" id="submissionTime" name="Submission Time" />
    <input type="hidden" id="submissionId" name="Submission ID" />

    <!-- Main Fields -->
    <div class="form-group"><label for="filledBy">Form Filled By</label><input type="text" id="filledBy" name="Form Filled By" required></div>
    <div class="form-group"><label for="clientName">Client Name</label><input type="text" id="clientName" name="Client Name" required></div>
    <div class="form-group"><label for="campaignType">Campaign Type</label><select id="campaignType" name="Campaign Type"><option value="">-- Select --</option><option>Manual Campaigns</option><option>SMS</option><option>Automation emails</option></select></div>
    <div class="form-group"><label for="jobType">Job Type</label><select id="jobType" name="Job Type"><option value="">-- Select --</option><option>Design only</option><option>Design + Coding</option><option>Coding only</option></select></div>
    <div class="form-group"><label for="noOfEmails">No of Emails</label><input type="number" id="noOfEmails" name="No of Emails"></div>
    <div class="form-group"><label for="emailName">Email/SMS/Automation Name</label><input type="text" id="emailName" name="Email/SMS/Automation Name"></div>
    <div class="form-group"><label for="esp">ESP</label><input type="text" id="esp" name="ESP"></div>
    <div class="form-group"><label for="fromName">From Name</label><input type="text" id="fromName" name="From Name"></div>
    <div class="form-group"><label for="fromEmail">From Email Address</label><input type="email" id="fromEmail" name="From Email Address"></div>
    <div class="form-group"><label for="replyToEmail">Reply-to Email Address</label><input type="email" id="replyToEmail" name="Reply-to Email Address"></div>
    <div class="form-group"><label for="subjectLine">Subject Line</label><input type="text" id="subjectLine" name="Subject Line"></div>
    <div class="form-group"><label for="previewText">Preview Text</label><input type="text" id="previewText" name="Preview Text"></div>
    <div class="form-group"><label for="abTest">A/B Testing</label><select id="abTest" name="A/B Testing"><option value="">-- Select --</option><option>Subject line A/B testing</option><option>Time</option><option>Content</option><option>Design changes / Layout changes</option><option>Other</option><option>No</option></select></div>
    <div class="form-group"><label for="abDetails">A/B Test Details</label><textarea id="abDetails" name="A/B Test Details"></textarea></div>
    <div class="form-group"><label for="mainList">Main List</label><input type="text" id="mainList" name="Main List"></div>
    <div class="form-group"><label for="segment">Segment</label><input type="text" id="segment" name="Segment"></div>
    <div class="form-group"><label for="count">Count (After Suppression)</label><input type="text" id="count" name="Count (After Suppression)"></div>
    <div class="form-group"><label for="campaignDate">Campaign Date</label><input type="date" id="campaignDate" name="Campaign Date"></div>

    <!-- Combined Campaign Time and Time Zone -->
    <div class="form-group">
      <label for="campaignTime">Campaign Time</label>
      <div style="display: flex; gap: 10px;">
        <input type="time" id="campaignTime" name="Campaign Time" />
        <select id="campaignTimeZone" name="Campaign Time Zone">
          <option value="">-- Time Zone --</option>
          <option value="PST">PST</option>
          <option value="MST">MST</option>
          <option value="CST">CST</option>
          <option value="EST">EST</option>
        </select>
      </div>
    </div>

    <div class="form-group"><label for="testEmail">Test Email List/Person</label><input type="text" id="testEmail" name="Test Email List/Person"></div>

    <!-- QA Checks as Dropdowns -->
    <div class="form-group"><label for="linkCheck">Link Check</label><select id="linkCheck" name="Link Check"><option>Yes</option><option>No</option></select></div>
    <div class="form-group"><label for="contentError">Content Error Check</label><select id="contentError" name="Content Error Check"><option>Yes</option><option>No</option></select></div>
    <div class="form-group"><label for="altTag">Alt Tag Check</label><select id="altTag" name="Alt Tag Check"><option>Yes</option><option>No</option></select></div>
    <div class="form-group"><label for="promoCode">Promo Code?</label><input type="text" id="promoCode" name="Promo code?"></div>
    <div class="form-group"><label for="canSpam">CAN-SPAM Compliant</label><select id="canSpam" name="CAN-SPAM Compliant"><option>Yes</option><option>No</option></select></div>
    <div class="form-group"><label for="unsubscribeLink">Unsubscribe Link</label><select id="unsubscribeLink" name="Unsubscribe Link"><option>Yes</option><option>No</option></select></div>
    <div class="form-group"><label for="salutation">Salutation (First Name)</label><select id="salutation" name="Salutation(First Name)"><option>Yes</option><option>No</option></select></div>
    <div class="form-group"><label for="spf">SPF</label><select id="spf" name="SPF"><option>PASS</option><option>FAIL</option></select></div>
    <div class="form-group"><label for="dkim">DKIM</label><select id="dkim" name="DKIM"><option>PASS</option><option>FAIL</option></select></div>
    <div class="form-group"><label for="dmarc">DMARC</label><select id="dmarc" name="DMARC"><option>PASS</option><option>FAIL</option></select></div>
    <div class="form-group"><label for="utm">UTM Tracking?</label><select id="utm" name="UTM Tracking?"><option>Yes</option><option>No</option></select></div>
    <div class="form-group"><label for="liveLink">Live Campaign Link</label><input type="text" id="liveLink" name="Live Campaign Link"></div>
    <div class="form-group"><label for="eoa">EOA</label><input type="text" id="eoa" name="EOA"></div>
    <div class="form-group"><label for="rendering">Any Rendering Issues - Device Name + Platform</label><input type="text" id="rendering" name="Any Rendering Issues - Device Name + Platform"></div>

    <!-- Campaign Approval -->
    <div class="form-group"><label for="campaignApproval">Campaign Approval</label><select id="campaignApproval" name="Campaign Approval"><option>Approved</option><option>Not Approved</option></select></div>

    <!-- Submit & Save Buttons -->
    <div class="form-group" style="text-align: center;">
      <button type="button" onclick="handleSubmit(event, 'save')">Save</button>
      <button type="button" onclick="handleSubmit(event, 'submit')">Submit</button>
    </div>
<form id="editForm" style="max-width: 900px; margin: auto;">
    <div class="form-group">
      <label for="searchResponseId">Enter Submission ID to Edit</label><br>
      <input type="text" id="searchResponseId" /><br><br>
      <button type="button" id="fetchDataBtn">Fetch Data</button>
    </div>
  </form>
    <!-- Submission ID Display -->
    <div id="submissionIdDisplay">Submission ID: <span id="submissionIdDisplayText"></span></div>
  </form>

  <script>
  const scriptURL = 'https://script.google.com/macros/s/AKfycbzn5R_R3jZl25SwaP617UyuufEd-EeSXIAuXLbjqWuNEzzkJHCRzcNlutDCIuxtLVBWUA/exec';

  function getUSTimeString(timeZone) {
    return new Date().toLocaleString("en-US", { timeZone: timeZone, hour12: true });
  }

  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('qaForm');
    
    // Initialize createDate with CST timezone
    document.getElementById("createDate").value = getUSTimeString("America/Chicago");

    form.addEventListener('submit', e => handleSubmit(e, "submit"));
    document.getElementById('saveBtn').addEventListener('click', e => handleSubmit(e, "save"));

    function handleSubmit(e, status) {
      e.preventDefault();

      // Set submissionTime to CST timezone
      document.getElementById("submissionTime").value = getUSTimeString("America/Chicago");

      // Combine Campaign Time and Time Zone into a single field
      const campaignTime = document.getElementById('campaignTime').value;
      const campaignTimeZone = document.getElementById('campaignTimeZone').value;
      const campaignDateTime = (campaignTime && campaignTimeZone) ? `${campaignTime} ${campaignTimeZone}` : '';

      // Add the combined Campaign Date and Time
      const formData = new FormData(form);
      formData.append("Form Status", status);
      formData.set("Campaign Date and Time", campaignDateTime);

      fetch(scriptURL, { method: 'POST', body: formData })
        .then(res => res.text())
        .then(id => {
          document.getElementById('submissionId').value = id;
          document.getElementById('submissionIdDisplay').innerText = `Submission ID: ${id}`;
          document.getElementById('submissionIdDisplay').style.display = 'block';
          alert(`${status === 'save' ? 'Saved' : 'Submitted'} successfully!`);
        })
        .catch(err => alert("Error submitting form: " + err));
    }

    document.getElementById('fetchDataBtn').addEventListener('click', () => {
      const id = document.getElementById('searchResponseId').value.trim();
      if (!id) return alert('Enter a Submission ID.');

      fetch(`${scriptURL}?action=get&id=${id}`)
        .then(res => res.json())
        .then(data => {
          if (data.status === 'success') {
            Object.keys(data.entry).forEach(key => {
              const field = document.querySelector(`[name="${key}"]`);
              if (field) field.value = data.entry[key];
            });
            document.getElementById('submissionIdDisplay').innerText = `Editing Submission ID: ${id}`;
            document.getElementById('submissionIdDisplay').style.display = 'block';
            document.getElementById('submissionId').value = id;
          } else {
            alert(`No entry found for Submission ID: ${id}`);
          }
        })
        .catch(err => alert("Failed to fetch data: " + err));
    });
  });
</script>

</body>
</html>
